"use strict";const FormHandler={config:{minAge:21,maxAge:70,minNameLength:2,maxNameLength:100,minTelegramLength:5,maxTelegramLength:32,successDisplayTime:5e3,errorDisplayTime:5e3,recaptchaSiteKey:"6LelqAYsAAAAABu8OjB6PGzGS7sQvxc1kVmKGwLh",recaptchaMinScore:.5,apiEndpoint:"https://test.reddawn.ru/recaptcha-verify",useMockApi:!1},elements:{form:null,nameInput:null,ageInput:null,telegramInput:null,phoneInput:null,contactTypeRadios:null,telegramField:null,phoneField:null,submitButton:null,successMessage:null,errorMessage:null},init:function(){this.cacheElements(),this.bindEvents(),this.setupLazyRecaptchaLoad()},setupLazyRecaptchaLoad:function(){const e=this;let t=!1;const n=function(){if(t||"undefined"!=typeof grecaptcha)return;t=!0;const n=document.createElement("script");n.src=`https://www.google.com/recaptcha/api.js?render=${e.config.recaptchaSiteKey}&badge=none`,n.async=!0,n.defer=!0,document.head.appendChild(n)};this.elements.form&&["focus","input","click"].forEach(function(t){e.elements.form.addEventListener(t,n,{once:!0,passive:!0})})},cacheElements:function(){this.elements.form=document.getElementById("join-form"),this.elements.form&&(this.elements.nameInput=this.elements.form.querySelector('input[name="name"]'),this.elements.ageInput=this.elements.form.querySelector('input[name="age"]'),this.elements.telegramInput=this.elements.form.querySelector('input[name="telegram"]'),this.elements.phoneInput=this.elements.form.querySelector('input[name="phone"]'),this.elements.contactTypeRadios=this.elements.form.querySelectorAll('input[name="contactType"]'),this.elements.telegramField=document.getElementById("telegram-field"),this.elements.phoneField=document.getElementById("phone-field"),this.elements.submitButton=this.elements.form.querySelector('button[type="submit"]'),this.elements.successMessage=document.getElementById("form-success"),this.elements.errorMessage=document.getElementById("form-error"))},bindEvents:function(){if(!this.elements.form)return;const e=this;this.elements.form.addEventListener("submit",function(t){t.preventDefault(),e.handleSubmit()}),this.elements.contactTypeRadios.forEach(function(t){t.addEventListener("change",function(){e.toggleContactField()})}),this.elements.phoneInput&&this.elements.phoneInput.addEventListener("input",function(t){e.formatPhoneInput(t)})},validateName:function(e){return/^[a-zA-Zа-яА-ЯёЁ\s]+$/.test(e)?e.length>this.config.maxNameLength?`Имя не может быть длиннее ${this.config.maxNameLength} символов.`:e.length<this.config.minNameLength?`Имя должно быть не короче ${this.config.minNameLength} символов.`:null:"Имя может содержать только буквы (кириллица или латиница) и пробелы."},validateAge:function(e){const t=parseInt(e);return isNaN(t)||t<0?"Возраст должен быть положительным числом.":t<this.config.minAge?`Набор в команду строго от ${this.config.minAge} года.`:t>this.config.maxAge?"Вряд ли вы потянете физически всю эту нагрузку...":null},validateTelegram:function(e){const t=e.startsWith("@")?e.slice(1):e;if((t.match(/@/g)||[]).length>0)return"Telegram username не может содержать символ @ внутри.";return/^[a-zA-Z0-9_]+$/.test(t)?t.length<this.config.minTelegramLength||t.length>this.config.maxTelegramLength?`Telegram username должен быть от ${this.config.minTelegramLength} до ${this.config.maxTelegramLength} символов.`:null:"Telegram username может содержать только буквы, цифры и подчеркивания."},validatePhone:function(e){return/^\+?\d+$/.test(e)?e.length<11?"Номер телефона слишком короткий.":e.length>16?"Номер телефона слишком длинный.":null:"Номер телефона может содержать только цифры и символ + в начале."},formatPhoneInput:function(e){const t=e.target;let n=t.value.replace(/[^\d+]/g,"");n.indexOf("+")>0&&(n=n.replace(/\+/g,""));(n.match(/\+/g)||[]).length>1&&(n="+"+n.replace(/\+/g,"")),t.value=n},toggleContactField:function(){"telegram"===this.elements.form.querySelector('input[name="contactType"]:checked').value?(this.elements.telegramField.classList.remove("hidden"),this.elements.phoneField.classList.add("hidden"),this.elements.telegramInput.required=!0,this.elements.phoneInput.required=!1,this.hideError(this.elements.phoneInput)):(this.elements.telegramField.classList.add("hidden"),this.elements.phoneField.classList.remove("hidden"),this.elements.telegramInput.required=!1,this.elements.phoneInput.required=!0,this.hideError(this.elements.telegramInput)),this.updateContactTypeStyles()},updateContactTypeStyles:function(){this.elements.contactTypeRadios.forEach(function(e){const t=e.parentElement.querySelector(".contact-type-box"),n=t.querySelectorAll(".corner-accent");e.checked?(t.classList.remove("border-red-dawn/30"),t.classList.add("border-red-dawn"),n.forEach(function(e){e.classList.remove("opacity-0")})):(t.classList.remove("border-red-dawn"),t.classList.add("border-red-dawn/30"),n.forEach(function(e){e.classList.add("opacity-0")}))})},showError:function(e,t){const n=e.closest(".relative").parentElement.querySelector(".error-message");n&&(n.textContent=`⚠ ${t}`,n.classList.remove("hidden")),e.classList.remove("border-red-dawn/30"),e.classList.add("border-red-dawn")},hideError:function(e){const t=e.closest(".relative").parentElement.querySelector(".error-message");t&&t.classList.add("hidden"),e.classList.remove("border-red-dawn"),e.classList.add("border-red-dawn/30")},handleSubmit:function(){const e=this;this.hideError(this.elements.nameInput),this.hideError(this.elements.ageInput),this.hideError(this.elements.telegramInput),this.hideError(this.elements.phoneInput);let t=!1;const n=this.validateName(this.elements.nameInput.value.trim());n&&(this.showError(this.elements.nameInput,n),t=!0);const s=this.validateAge(this.elements.ageInput.value);s&&(this.showError(this.elements.ageInput,s),t=!0);if("telegram"===this.elements.form.querySelector('input[name="contactType"]:checked').value){const e=this.validateTelegram(this.elements.telegramInput.value.trim());e&&(this.showError(this.elements.telegramInput,e),t=!0)}else{const e=this.validatePhone(this.elements.phoneInput.value.trim());e&&(this.showError(this.elements.phoneInput,e),t=!0)}const i=parseInt(this.elements.ageInput.value);if(!isNaN(i)&&i>this.config.maxAge&&(t=!0),t)return this.elements.form.classList.add("animate-shake"),void setTimeout(function(){e.elements.form.classList.remove("animate-shake")},500);this.elements.submitButton.disabled=!0,this.elements.submitButton.innerHTML='\n            <div class="relative bg-red-dawn border-2 border-red-dawn transition-all px-6 py-3 sm:px-8 sm:py-4">\n                \x3c!-- Button Corners --\x3e\n                <div class="absolute top-0 left-0 w-3 h-3 bg-black-base"></div>\n                <div class="absolute top-0 right-0 w-3 h-3 bg-black-base"></div>\n                <div class="absolute bottom-0 left-0 w-3 h-3 bg-black-base"></div>\n                <div class="absolute bottom-0 right-0 w-3 h-3 bg-black-base"></div>\n                \n                <div class="flex items-center justify-center gap-3">\n                    <svg class="animate-spin h-5 w-5 text-text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">\n                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n                    </svg>\n                    <span class="font-russo text-text-primary text-base sm:text-lg tracking-wider uppercase">ПРОВЕРКА КАПЧИ...</span>\n                </div>\n            </div>\n        ',"undefined"!=typeof grecaptcha?grecaptcha.ready(function(){grecaptcha.execute(e.config.recaptchaSiteKey,{action:"submit"}).then(function(t){e.submitForm(t)}).catch(function(t){e.showFormError("Ошибка проверки капчи. Попробуй обновить страницу."),e.resetSubmitButton()})}):e.submitForm(null)},submitForm:function(e){const t=this,n=this.elements.form.querySelector('input[name="contactType"]:checked').value,s={name:this.elements.nameInput.value.trim(),age:parseInt(this.elements.ageInput.value),experience:this.elements.form.querySelector('input[name="experience"]:checked').value,recaptchaToken:e,timestamp:(new Date).toISOString()};if("telegram"===n){let e=this.elements.telegramInput.value.trim();e.startsWith("@")||(e="@"+e),s.telegram=e,s.contactType="telegram"}else s.phone=this.elements.phoneInput.value.trim(),s.contactType="phone";fetch(this.config.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(e){return e.ok?e.json():e.json().then(function(e){throw new Error(e.detail||"Ошибка сервера")})}).then(function(e){"ok"===e.status?t.showSuccess():(t.showFormError(e.message||"Проверка капчи не пройдена."),t.resetSubmitButton())}).catch(function(e){t.showFormError(e.message||"Ошибка соединения с сервером."),t.resetSubmitButton()})},showSuccess:function(){const e=this;this.elements.form.classList.add("hidden"),this.elements.successMessage.classList.remove("hidden"),setTimeout(function(){e.elements.successMessage.classList.add("hidden"),e.elements.form.reset(),e.resetSubmitButton(),e.hideError(e.elements.nameInput),e.hideError(e.elements.ageInput),e.hideError(e.elements.telegramInput),e.hideError(e.elements.phoneInput),e.toggleContactField(),e.updateContactTypeStyles(),e.elements.form.classList.remove("hidden")},this.config.successDisplayTime)},showFormError:function(e){const t=this;if(this.elements.errorMessage){const t=this.elements.errorMessage.querySelector("#error-message");t&&(t.textContent=e)}this.elements.form.classList.add("hidden"),this.elements.errorMessage.classList.remove("hidden"),setTimeout(function(){t.elements.errorMessage.classList.add("hidden"),t.resetSubmitButton(),t.elements.form.classList.remove("hidden")},this.config.errorDisplayTime)},resetSubmitButton:function(){this.elements.submitButton.disabled=!1,this.elements.submitButton.innerHTML='\n            <div class="relative bg-red-dawn hover:bg-red-crimson border-2 border-red-dawn transition-all px-6 py-3 sm:px-8 sm:py-4">\n                \x3c!-- Button Corners --\x3e\n                <div class="absolute top-0 left-0 w-3 h-3 bg-black-base"></div>\n                <div class="absolute top-0 right-0 w-3 h-3 bg-black-base"></div>\n                <div class="absolute bottom-0 left-0 w-3 h-3 bg-black-base"></div>\n                <div class="absolute bottom-0 right-0 w-3 h-3 bg-black-base"></div>\n                \n                <div class="flex items-center justify-center gap-3">\n                    <span class="font-russo text-text-primary text-base sm:text-lg tracking-wider uppercase">ОТПРАВИТЬ ЗАЯВКУ</span>\n                    <svg class="w-5 h-5 text-text-primary transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>\n                    </svg>\n                </div>\n            </div>\n        '}};